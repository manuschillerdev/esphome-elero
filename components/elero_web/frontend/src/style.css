/* ─── Reset & base ────────────────────────────────────────────────────────── */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --blue:    #1a73e8;
  --blue-dk: #1557b0;
  --red:     #d32f2f;
  --red-dk:  #b71c1c;
  --green:   #2e7d32;
  --amber:   #e65100;
  --bg:      #f0f2f5;
  --surface: #ffffff;
  --border:  #e0e0e0;
  --muted:   #757575;
  --text:    #212121;
  --radius:  8px;
  --shadow:  0 1px 4px rgba(0,0,0,.12);
}

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.5;
  font-size: 14px;
}

[x-cloak] { display: none !important; }

/* ─── Layout ──────────────────────────────────────────────────────────────── */
#app { max-width: 760px; margin: 0 auto; padding: 12px 12px 40px; }

/* ─── Header ──────────────────────────────────────────────────────────────── */
.header {
  display: flex;
  align-items: center;
  gap: 10px;
  background: var(--blue);
  color: #fff;
  padding: 14px 16px;
  border-radius: var(--radius);
  margin-bottom: 10px;
}
.header h1 { font-size: 1.1em; font-weight: 600; flex: 1; }
.header-right { font-size: .8em; opacity: .8; }
.uptime { font-size: .78em; opacity: .75; }

/* ─── Tabs ────────────────────────────────────────────────────────────────── */
.tabs {
  display: flex;
  background: var(--surface);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  margin-bottom: 12px;
  overflow: hidden;
}
.tab-btn {
  flex: 1;
  padding: 10px 4px;
  border: none;
  background: none;
  font-size: .85em;
  font-weight: 500;
  color: var(--muted);
  cursor: pointer;
  transition: color .15s, border-bottom .15s;
  border-bottom: 3px solid transparent;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 4px;
}
.tab-btn.active { color: var(--blue); border-bottom-color: var(--blue); }
.tab-btn:hover:not(.active) { color: var(--text); background: #f8f9fa; }

.tab-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  background: var(--blue);
  color: #fff;
  border-radius: 10px;
  font-size: .7em;
  min-width: 18px;
  height: 18px;
  padding: 0 4px;
  font-weight: 700;
}
.tab-badge.log-badge { background: var(--amber); }

.tab-content { min-height: 200px; }

/* ─── Cards ──────────────────────────────────────────────────────────────── */
.card {
  background: var(--surface);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  margin-bottom: 12px;
  overflow: hidden;
}
.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 14px;
  background: #f8f9fa;
  border-bottom: 1px solid var(--border);
  font-weight: 600;
  font-size: .9em;
}
.card-body { padding: 14px; }

/* ─── Buttons ─────────────────────────────────────────────────────────────── */
.btn {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 7px 14px;
  border: none;
  border-radius: 6px;
  font-size: .85em;
  font-weight: 500;
  cursor: pointer;
  transition: background .15s;
  white-space: nowrap;
}
.btn:disabled { opacity: .45; cursor: not-allowed; }
.btn-primary  { background: var(--blue);    color: #fff; }
.btn-primary:hover:not(:disabled) { background: var(--blue-dk); }
.btn-danger   { background: var(--red);     color: #fff; }
.btn-danger:hover:not(:disabled)  { background: var(--red-dk); }
.btn-outline  { background: #fff; color: var(--blue); border: 1px solid var(--blue); }
.btn-outline:hover:not(:disabled) { background: #e8f0fe; }
.btn-open     { background: #e8f5e9; color: var(--green); border: 1px solid #a5d6a7; }
.btn-close    { background: #fce4ec; color: var(--red);   border: 1px solid #f48fb1; }
.btn-stop     { background: #f5f5f5; color: #424242;      border: 1px solid #bdbdbd; }
.btn-tilt     { background: #e3f2fd; color: var(--blue);  border: 1px solid #90caf9; }
.btn-sm { padding: 4px 10px; font-size: .8em; }

.btn-row { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }

/* ─── Cover card ─────────────────────────────────────────────────────────── */
.cover-card { padding: 14px; }
.cover-header { display: flex; justify-content: space-between; align-items: flex-start; }
.cover-name { font-weight: 600; font-size: .95em; }
.cover-meta { font-size: .8em; color: var(--muted); margin-top: 2px; display: flex; gap: 8px; flex-wrap: wrap; }
.cover-right { display: flex; flex-direction: column; align-items: flex-end; gap: 4px; }

.pos-bar { height: 6px; background: #e0e0e0; border-radius: 3px; overflow: hidden; margin: 8px 0 2px; }
.pos-fill { height: 100%; background: var(--blue); transition: width .4s; }
.pos-label { font-size: .8em; color: var(--muted); }

.last-seen { font-size: .78em; color: var(--muted); margin-top: 4px; }

.settings-btn { margin-left: auto; }

/* ─── Settings panel ─────────────────────────────────────────────────────── */
.settings-panel {
  margin-top: 12px;
  border-top: 1px solid var(--border);
  padding-top: 10px;
}
.settings-row {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
  font-size: .85em;
}
.settings-row label { min-width: 140px; color: var(--muted); }
.settings-row input {
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 5px 8px;
  font-size: .9em;
  width: 130px;
}
.settings-row input:focus { outline: none; border-color: var(--blue); }
.settings-footer { display: flex; justify-content: flex-end; margin-top: 4px; }

/* ─── State badges ───────────────────────────────────────────────────────── */
.state-badge {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: .76em;
  font-weight: 600;
  white-space: nowrap;
}
.state-top        { background: #e8f5e9; color: var(--green); }
.state-bottom     { background: #fce4ec; color: var(--red); }
.state-moving_up, .state-start_moving_up, .state-opening
                  { background: #fff3e0; color: var(--amber); }
.state-moving_down,.state-start_moving_down,.state-closing
                  { background: #fff3e0; color: var(--amber); }
.state-intermediate,.state-stopped
                  { background: #e3f2fd; color: #1565c0; }
.state-idle,.state-unknown
                  { background: #f5f5f5; color: var(--muted); }
.state-blocking,.state-overheated,.state-timeout
                  { background: #ffebee; color: var(--red); }
.state-tilt,.state-top_tilt,.state-bottom_tilt
                  { background: #f3e5f5; color: #6a1b9a; }

.adopted-tag {
  font-size: .72em;
  color: var(--blue);
  border: 1px solid var(--blue);
  border-radius: 4px;
  padding: 1px 5px;
}
.configured-tag {
  font-size: .76em;
  color: var(--green);
  font-weight: 600;
}

/* ─── Discovery card ─────────────────────────────────────────────────────── */
.disc-card { padding: 12px 14px; }
.disc-card.known { opacity: .7; }
.disc-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
.disc-meta { display: flex; flex-wrap: wrap; gap: 10px; font-size: .82em; color: var(--muted); }

/* ─── Scan status dot ────────────────────────────────────────────────────── */
.scan-status { display: flex; align-items: center; gap: 6px; font-size: .85em; }
.status-dot  { width: 8px; height: 8px; border-radius: 50%; background: #9e9e9e; }
.status-dot.scanning { background: #4caf50; animation: pulse 1s infinite; }
@keyframes pulse { 0%,100%{opacity:1}50%{opacity:.3} }

.hint { font-size: .8em; color: var(--muted); margin-top: 8px; }

/* ─── Log tab ────────────────────────────────────────────────────────────── */
.log-controls {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-wrap: wrap;
  font-size: .85em;
}
.level-select {
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 4px 6px;
  font-size: .85em;
}
.check-label { display: flex; align-items: center; gap: 4px; font-size: .82em; }

.log-box {
  max-height: 420px;
  overflow-y: auto;
  font-family: 'Menlo', 'Consolas', monospace;
  font-size: .78em;
  line-height: 1.6;
  padding: 8px;
  background: #1e1e2e;
  border-radius: 6px;
  margin-top: 10px;
}
.log-line { display: flex; gap: 8px; padding: 1px 0; }
.log-ts    { color: #888; min-width: 60px; }
.log-level { min-width: 48px; font-weight: 700; }
.log-tag   { color: #7dcfff; min-width: 96px; }
.log-msg   { color: #cdd6f4; word-break: break-all; }
.blind-ref { color: #a6e3a1; font-weight: 700; }

.log-error .log-level  { color: #f38ba8; }
.log-warn  .log-level  { color: #fab387; }
.log-info  .log-level  { color: #a6e3a1; }
.log-debug .log-level  { color: #89b4fa; }
.log-verbose .log-level{ color: #6c7086; }

/* ─── Configuration — frequency ──────────────────────────────────────────── */
.freq-row { margin-bottom: 10px; }
.freq-preset {
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 6px 8px;
  font-size: .85em;
}
.freq-inputs { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 10px; }
.freq-field { display: flex; flex-direction: column; gap: 2px; }
.freq-field label { font-size: .78em; color: var(--muted); }
.freq-input { width: 90px; border: 1px solid #ccc; border-radius: 6px; padding: 6px 8px; font-size: .9em; }
.freq-input:focus { outline: none; border-color: var(--blue); }

/* ─── Configuration — packet dump ───────────────────────────────────────── */
.badge {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: .75em;
  font-weight: 600;
}
.badge-active { background: #e8f5e9; color: var(--green); }
.badge-idle   { background: #f5f5f5; color: var(--muted); }
.badge-count  { background: #e3f2fd; color: #1565c0; }

.dump-wrap { overflow-x: auto; max-height: 360px; overflow-y: auto; margin-top: 10px; }
.pkt-table { width: 100%; border-collapse: collapse; font-size: .78em; }
.pkt-table th { background: #f8f9fa; padding: 5px 8px; text-align: left; border-bottom: 2px solid var(--border); font-weight: 600; white-space: nowrap; }
.pkt-table td { padding: 4px 8px; border-bottom: 1px solid #f0f0f0; vertical-align: top; }
.pkt-ok  { background: #f1f8f4; }
.pkt-err { background: #fff5f5; }
.pkt-hex { font-family: monospace; font-size: .85em; word-break: break-all; }
.pkt-ok-badge  { color: var(--green); font-weight: 700; }
.pkt-err-badge { color: var(--red);   font-weight: 700; }

/* ─── Info grid ──────────────────────────────────────────────────────────── */
.info-grid { display: grid; grid-template-columns: 130px 1fr; gap: 6px 10px; font-size: .87em; }
.info-label { color: var(--muted); font-weight: 500; }

/* ─── Modals ──────────────────────────────────────────────────────────────── */
.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.5);
  z-index: 100;
  align-items: center;
  justify-content: center;
}
.modal-overlay.active { display: flex; }
.modal {
  background: #fff;
  border-radius: 12px;
  width: 90%;
  max-width: 520px;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 8px 32px rgba(0,0,0,.2);
}
.modal-header {
  padding: 14px 16px;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.modal-header h3 { font-size: .95em; }
.modal-close { background: none; border: none; font-size: 1.4em; cursor: pointer; color: var(--muted); }
.modal-close:hover { color: var(--text); }
.modal-body { padding: 14px; }
.modal-footer { padding: 10px 14px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 8px; }

.yaml-box {
  background: #263238;
  color: #e0e0e0;
  border-radius: 6px;
  padding: 12px;
  font-family: monospace;
  font-size: .8em;
  white-space: pre;
  overflow-x: auto;
  line-height: 1.6;
  max-height: 360px;
  overflow-y: auto;
}

/* ─── Toast ───────────────────────────────────────────────────────────────── */
.toast {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%);
  background: #333;
  color: #fff;
  padding: 10px 20px;
  border-radius: 8px;
  font-size: .88em;
  z-index: 200;
  opacity: 0;
  pointer-events: none;
  transition: opacity .25s;
  white-space: nowrap;
}
.toast.show  { opacity: 1; }
.toast.error { background: var(--red); }

/* ─── Misc ────────────────────────────────────────────────────────────────── */
.mono { font-family: monospace; }
.empty {
  text-align: center;
  padding: 28px;
  color: var(--muted);
  font-size: .9em;
}
